## Настройка и удаление пакета

| Команда                 | Аргументы |
|-------------------------|:---------:|
| kvas setup              |     -     |
| kvas uninstall [remove] |  [full]   |

```
setup             - настройка пакета после его установки через 'opkg install'.
uninstall <full>  - удаление пакета, при наличии опции full удаляем ПОЛНОСТЬЮ со всем
remove <full>       зависимыми пакетами и архивными файлами, без аргумента - удаление
                    пакета без зависимых пакетов, но с архивными файлами.
```

## Управление 'Белым списком'
| Команда                    | Аргументы |
|----------------------------|:---------:|
| kvas add / kvas new        | [*][хост] |
| kvas del / kvas rm         | [*][хост] |
| kvas purge / kvas clear    |     -     |

```
add[new]     - добавляем один хост в список разблокировки, аргументом
               является добавляемый хост. 
               * - в начале домена включает режим wildcard (пример: *mydomain.com).
               без * - режим wildcard отключен. Также, есть возможность добавлять
               в список разблокировали IP адреса и их диапазоны в виде XX.XX.XX.XX, 
               XX.XX.XX.XX-XX.XX.XX.XX и в виде XX.XX.XX.XX/XX иные варианты 
               не допустимы. Начиная с версии 1.1.1, появилась возможность добавлять
               доменные имена с префиксом http[s]://, который подлежит отсечению при 
               добавлении в "Белый список". Это удобно, если Вы добавляете домен из 
               буфера обмена. При этом, в случае, если Вы хотите добавить поддержку 
               wildcard, то необходимо вставлять звездочку после префикса http[s]://, 
               например kvas add https://*domen.com
               
               При добавлении любого из доменов в список разлокировки, 
               в случае подключенной опции блокирования рекламы 'kvas adblock on', 
               добавляемые доменные имена проходят проверку на наличие их в списке 
               блокировки рекламы и в случае их наличия они удаляются от туда. 
               Причем, если добавлен домен в виде *domain.com, то будут 
               удалены все доменные имена с основанием domain.com, выше 
               второго уровня, т.е. удалению подлежат, все имена от domain.com 
               до dm5.dm4.dm3.domain.com и выше. Но удалению не подлежат 
               такие имена, которые не заканчиваются на domain.com, 
               как например domain.com.ru.org.
               
    
del[rm]      - удаляем указанный хост из списка разблокировки.
purge[clear] - полностью очищаем список разблокировки.
```

## Управление экспортом/импортом
| Команда                      | Аргументы |
|------------------------------|:---------:|
| kvas / kvas show / kvas list |     -     |
| kvas export                  |  [файл]   |
| kvas import                  |  [файл]   |

```
show[list] - выводим список всех хостов в списках разблокировки
             и блокировки. Список отображается, в том числе, при запуске
             команды kvas без аргументов.

export     - экспорт Белого списка в указанный файл.

import     - добавляем хосты из указанного файла в Белый списко
             допускается использование комментариев с символом '#'.
```

## Управление обновлениями маршрутов
| Команда               | Аргументы |
|-----------------------|:---------:|
| kvas update/reset     |     -     |
| kvas period           | [период]  |
| kvas period del/clear |     -     |

```
update           - обновляем/переустанавливаем все таблицы, списки ipset IP адресов.
reset            - данная процедура универсальна для любого из подключений.
      
period           - установка/просмотр периода обновления IP адресов
                   для списочного файла. Период должно указывать
                   в форматах: m,h,d,w,n, например:
      
                     2m - обновляем каждые две минуты
                     2h - обновляем каждые два часа
                     3d - обновляем каждые три дня
                     4w - обновляем каждые четыре недели
                     2M - обновляем каждых два месяца
      
                   Возможен только один из вариантов, например:
                   10m или 2h, по умолчанию -период обновления каждые
                   12 часов или 2 раза в сутки.
period del|clear - удаление обновления периода обновления IP адресов из cron
```

## AdGuard Home
| Команда             | Аргументы |
|---------------------|:---------:|
| kvas adguard        |     -     |
| kvas adguard on     |     -     |
| kvas adguard off    |     -     |
| kvas adguard test   |     -     |
| kvas adguard update |     -     |

```
adguard        - выводит состояние режима AdGuard.
adguard test   - тестирует правила создания ipset для AdGuard Home
adguard on     - устанавливаем AdGuard Home в качестве DNS сервера, вместо
                 dnscrypt-proxy2 или вместо текущего DNS. AdGuard Home,
                 при этом, должен быть установлен и настроен на роутере или
                 на любом другом устройстве в локальной сети.
adguard off    - отключает использование AdGuard Home в КВАСе
adguard update - производит обновление на новую версию пакета, если она доступна
```

## Блокировка рекламы
| Команда           | Аргументы |
|-------------------|:---------:|
| kvas adblock      |     -     |
| kvas adblock on   |     -     |
| kvas adblock add  |   host    |
| kvas adblock del  |   host    |
| kvas adblock off  |     -     |
| kvas adblock edit |     -     | 

```
adblock           - выводит состояние режима блокировки рекламы.
adblock on        - включаем, блокировку рекламы.
adblock off       - отключаем, блокировку рекламы.
adblock add <d>   - добавляем домен в список исключений и удаляем его 
                    из списка блокировки рекламы.
adblock del <d>   - удаляем доменное имя из списка исключений.
adblock edit      - редактируем список источников блокировки рекламы.
                    Обработке подлежат лишь те, файлы, которые содержат
                    записи в формате 0.0.0.0 <домен> или 127.0.0 <домен>.
               
```


## Шифрование DNS запросов
| Команда        | Аргументы |
|----------------|:---------:|
| kvas crypt     |     -     |
| kvas crypt on  |     -     |
| kvas crypt off |     -     |

```
crypt     - выводим статус шифрования dns (включено/отключено).
crypt on  - включаем,  шифрование dns (пакет dnscrypt-proxy2).
crypt off - отключаем, шифрование dns.
```
## Подключение гостевых интерфейсов
| Команда         | Аргументы |
|-----------------|:---------:|
| kvas bridge     |     -     |
| kvas bridge add |    all    |
| kvas bridge del |    all    |

```
bridge         - выводит список доступных гостевых интерфейсов
bridge add all - разрешаем доступ к VPN всем существующим гостевым сетям
bridge del all - запрещаем доступ к VPN для всех гостевых сетей.
```

## Управление DNS
| Команда        | Аргументы |
|----------------|:---------:|
| kvas dns       |     -     |
| kvas dns <DNS> |  [IPv4]   |
| kvas dns test  |     -     |

```
dns                   - отображаем текущий DNS (по умолчанию) для работы пакета.
dns <DNS>             - устанавливаем DNS (по умолчанию) для пакета в значение <DNS>.
dns test <domain.com> - тестируем работу DNS (по умолчанию) в пакете.
```

## Управление VPN соединениями
| Команда               | Аргументы |
|-----------------------|:---------:|
| kvas vpn              |     -     |
| kvas vpn set          |     -     |
| kvas vpn reset        |     -     |
| kvas vpn rescan[scan] |     -     |
| kvas vpn guest        |     -     |
| kvas vpn guest        |    brN    |
| kvas vpn guest del    |     -     |

```
vpn             - отображаем текущий тип VPN соединения и его состояние.
vpn set         - меняем текущий VPN интерфейс, путем выбора из списка доступных.
vpn reset       - обновляем таблицу правил iptables для vpn подключения: чистим ее и затем заполняем.
vpn rescan|scan - принудительное сканирование интерфейсов роутера, в случае, 
                  появления нового подключения, например wireguard или openvpn..
vpn guest <brN> - добавляем правила iptable для гостевой сети или VPN сети,
                  по которой подключаются клиенты к роуеру, чтобы клиенты могли
                  ходить на сайты находящиеся в списочном файле.
                  Здесь brN - это идентификатор гостевой сети или VPN подключения
                  в терминах entware, например br1 или open_vpn0 или nwg2.
                  Узнать название сети можно по команде 'ip a' на роутере.
vpn guest       - команда без аргументов выводит, в случае наличия,
                  текущую гостевую сеть.
vpn guest del   - команда без аргументов удаляет гостевую сеть в случае ее наличия.
```

## Управление shadowsocks соедиением
| Команда        |    Аргументы    |
|----------------|:---------------:|
| kvas ssr       |        -        |
| kvas ssr new   |        -        |
| kvas ssr reset |        -        |
| kvas ssr port  | [порт] / ничего |

```
ssr          - отображаем текущий тип VPN соединения и его состояние (тоже что и ключ 'vpn').

ssr new      - меняет настройки учетной записи shadowsocks сервера на другие настройки, 
               в случае смены сервера или иных данных учетной записи

ssr port     - отображаем текущий локальный порт Shadowsocks соединения.
ssr port <N> - меняем текущий локальный порт Shadowsocks соединения на <N>.
ssr reset    - обновляем таблицу правил iptables для Shadowsocks соединения: чистим ее и затем заполняем.
```

## Управление dnsmasq
| Команда           |    Аргументы    |
|-------------------|:---------------:|
| kvas dnsmasq      |        -        |
| kvas dnsmasq port | [порт] / ничего |
| kvas dnsmasq ip   |  [ip] / ничего  |

```
dnsmasq          - отображаем текущие порт и IP, которые прослушивает служба dnsmasq.
dnsmasq port     - отображаем текущий порт, который прослушивает служба dnsmasq.
dnsmasq port <N> - меняем текущий порт, который прослушивает служба dnsmasq на <N>.
dnsmasq ip       - отображаем текущий IP, который прослушивает служба dnsmasq.
dnsmasq ip <N>   - меняем текущий IP, который прослушивает служба dnsmasq на <N>.
```

## Отладка
| Команда      | Аргументы |
|--------------|:---------:|
| kvas test    |     -     |
| kvas debug   |     -     |

```
test  - проверка работы всех служб, задействованных в работе КВАСА.
debug - вывод отладочной информации в случае сбоев в работе КВАСА.
```

## Помощь

| Команда                        | Аргументы |
|--------------------------------|:---------:|
| kvas version / kvas ver        |     -     |
| kvas help / kvas -h / kvas --h |     -     |

```
version | ver     - отображаем версию утилиты.
help | -h | --h   - отображается справка.  
```

## НАВИГАЦИЯ
- Назад на [Описание пакета](https://github.com/qzeleza/kvas/wiki/Home)
- Вперед на [Описание команд](https://github.com/qzeleza/kvas/wiki/Описание-команд)
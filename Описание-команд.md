## Настройка и удаление пакета

| Команда                 | Аргументы |
|-------------------------|:---------:|
| kvas setup              |     -     |
| kvas uninstall [remove] |  [full]   |

```
setup              - настройка пакета после его установки через 'opkg install'.
uninstall <full>   - удаление пакета, при наличии опции full удаляем ПОЛНОСТЬЮ со всем
remove <full>        зависимыми пакетами и архивными файлами, без аргумента - удаление
                     пакета без зависимых пакетов, но с архивными файлами.
```

## Обновление пакета

| Команда                 | Аргументы |
|-------------------------|:---------:|
| kvas upgrade            |           |
| kvas upgrade            |  [full]   |
| kvas upgrade            |  [force full]  |

```
upgrade            - проверка на наличие новой версии пакета и последующее его обновление,
                     при этом оставляем предыдущие данные конфигурации.
upgrade full       - проверка на наличие новой версии пакета и последующее его обновление,
                     с полным удалением данных от предыдущей версии, кроме файла с 
                     доменными именами от предыдущей версии.
upgrade force      - переустановка пакета (принудительное обновление пакета), даже при 
                     отсутствии новой его версии, при этом оставляем данные от предыдущей 
                     конфигурации пакета.
upgrade force full - переустановка пакета (принудительное обновление пакета), с полным 
                     удалением предыдущих данных, кроме файла с доменными именами 
                     от предыдущей версии.
```

## Откат пакета на предыдущие версии

| Команда                 | Аргументы |
|-------------------------|:---------:|
| kvas rollback           |  [full]   |

```
rollback           - "откат" пакета на предыдущую версию
rollback full      - "откат" пакета на предыдущую версию, с полным удалением предыдущих данных
```

## Управление 'Белым списком'
| Команда                    | Аргументы |
|----------------------------|:---------:|
| kvas add / kvas new        | [*][хост] |
| kvas del        | [*][хост] |
| kvas purge / kvas clear    |     -     |

```
add[new]     - добавляем один хост в список разблокировки, аргументом
               является добавляемый хост. 
               Eсть возможность добавлять в список разблокировки IP адреса 
               и их диапазоны в виде XX.XX.XX.XX, XX.XX.XX.XX-XX.XX.XX.XX 
               и в виде XX.XX.XX.XX/XX иные варианты не допустимы. Есть возможность 
               добавлять доменные имена с префиксом http[s]://, который подлежит 
               отсечению при добавлении в "Белый список". Это удобно, если Вы 
               добавляете домен из буфера обмена. 

               В случае, если Вы хотите добавить поддержку **wildcard**,
               то можно либо ничего не указывать и при исполнении команды у Вас 
               спросят о необходимости добавлять поддержку **wildcard**. 
               Если указать третьим параметром '**yes**' - добавление домена 
               в этом случае произойдет с поддержкой **wildcard**, 
               если указать '**no**', то без оной, без какого либо запроса. 
               
               При добавлении любого из доменов в список разлокировки, 
               в случае подключенной опции блокирования рекламы 'kvas adblock on', 
               добавляемые доменные имена проходят проверку на наличие их в списке 
               блокировки рекламы и в случае их наличия они удаляются от туда. 
               Причем, если добавлен домен в виде *domain.com, то будут 
               удалены все доменные имена с основанием domain.com, выше 
               второго уровня, т.е. удалению подлежат, все имена от domain.com 
               до dm5.dm4.dm3.domain.com и выше. Но удалению не подлежат 
               такие имена, которые не заканчиваются на domain.com, 
               как например domain.com.ru.org.
               
    
del      - удаляем указанный хост из списка разблокировки.
purge[clear] - полностью очищаем список разблокировки.

Пример добавления **chat.openai.com** (добавлен в список Кваса по умолчанию* ):

1. Добавляем в Квас все поддомены домена  openai.com командой: `kvas add openai.com`
2. Заходим на сайт chat.openai.com и видим не отформатированный вид страницы.
3. Заходим в режим "Разработчика" в браузере в раздел "Ошибки" и видим, что множество 403 ошибок нам выдает всего один сайт cdn.oaistatic.com. Далее добавляем этот сайт в Квас командой `kvas add oaistatic.com`
```

## Управление экспортом/импортом
| Команда                      | Аргументы |
|------------------------------|:---------:|
| kvas / kvas show / kvas list |     -     |
| kvas / kvas search/find      |  [домен]  |
| kvas export                  |  [файл]   |
| kvas import                  |  [файл]   |

```
show[list] - выводим список всех хостов в списках разблокировки
             и блокировки. Список отображается, в том числе, при запуске
             команды kvas без аргументов.
search
find       - поиск домена или его части в в списке разблокировки.
export     - экспорт Белого списка в указанный файл.

import     - добавляем хосты из указанного файла в Белый список.
             Допускается использование комментариев с символом '#'.
             Один домен/ip/интервал - одна строка. Файл импорта должен 
             создаваться с форматом отступов на unix (LF), а не Windows (CR LF)
             в противном случае, будут возникать ошибки при импортировании списка. 

[файл]     - путь до файла, например /opt/tmp/my_hosts.list 
[домен]    - любая строка для поиска домена или IP в списке   
```

## Сброс маршрутов
| Команда               | Аргументы |
|-----------------------|:---------:|
| kvas update/reset     |     -     |


```
update           - обновляем/переустанавливаем все таблицы, списки ipset IP адресов.
reset            - данная процедура универсальна для любого из подключений.
```

## AdGuard Home
| Команда             | Аргументы |
|---------------------|:---------:|
| kvas adguard        |     -     |
| kvas adguard on     |     -     |
| kvas adguard off    |     -     |
| kvas adguard test   |     -     |
| kvas adguard update |     -     |

```
adguard        - выводит состояние режима AdGuard.
adguard test   - тестирует правила создания ipset для AdGuard Home
adguard on     - устанавливаем AdGuard Home в качестве DNS сервера, вместо
                 dnscrypt-proxy2 или вместо текущего DNS. AdGuard Home,
                 при этом, должен быть установлен и настроен на роутере, 
                 на котором установлен Квас (до версии **1.1.8 realese 2**, включительно).
adguard off    - отключает использование AdGuard Home в КВАСе
adguard update - производит обновление на новую версию пакета, если она доступна
```

## Блокировка рекламы
| Команда           | Аргументы |
|-------------------|:---------:|
| kvas adblock      |     -     |
| kvas adblock on   |     -     |
| kvas adblock add  |   host    |
| kvas adblock del  |   host    |
| kvas adblock off  |     -     |
| kvas adblock edit |     -     | 

```
adblock           - выводит состояние режима блокировки рекламы.
adblock on        - включаем, блокировку рекламы.
adblock off       - отключаем, блокировку рекламы.
adblock add <d>   - добавляем домен в список исключений и удаляем его 
                    из списка блокировки рекламы.
adblock del <d>   - удаляем доменное имя из списка исключений.
adblock edit      - редактируем список источников блокировки рекламы.
                    Обработке подлежат лишь те, файлы, которые содержат
                    записи в формате 0.0.0.0 <домен> или 127.0.0 <домен>.
               
```


## Шифрование DNS запросов
| Команда        | Аргументы |
|----------------|:---------:|
| kvas crypt     |     -     |
| kvas crypt on  |     -     |
| kvas crypt off |     -     |

```
crypt     - выводим статус шифрования dns (включено/отключено).
crypt on  - включаем,  шифрование dns (пакет dnscrypt-proxy2).
crypt off - отключаем, шифрование dns.
```

## Управление DNS
| Команда        | Аргументы |
|----------------|:---------:|
| kvas dns       |     -     |
| kvas dns test  |     -     |

```
dns                   - отображаем текущий DNS (по умолчанию) для работы пакета.
dns test <domain.com> - тестируем работу DNS (по умолчанию) в пакете.
```


## Редактирование файла /opt/etc/hosts

| Команда                 | Аргументы |
|-------------------------|:---------:|
| hosts edit           |     |
| hosts add            |  [IP] [имя_домена]  |

```
hosts edit                  - редактируем при помощи nano файл /opt/etc/hosts и затем производим перегрузку необходимых сервисов
hosts add [IP] [имя_домена] - добавляем в файл /opt/etc/hosts новую запись и затем производим перегрузку необходимых сервисов
```



## Управление VPN соединениями
| Команда               | Аргументы |
|-----------------------|:---------:|
| kvas vpn              |     -     |
| kvas vpn set          |     -     |
| kvas vpn reset        |     -     |
| kvas vpn rescan[scan] |     -     |
| kvas vpn net          |     -     |
| kvas vpn net add      |     -     |
| kvas vpn net del      |     -     |

```
vpn             - отображаем текущий тип `VPN` соединения и его состояние.
vpn set         - меняем текущий `VPN` интерфейс, путем выбора из списка доступных.
vpn reset       - обновляем таблицу правил `iptables` для `vpn` подключения: чистим ее и затем заполняем.
vpn rescan|scan - принудительное сканирование интерфейсов роутера, в случае, 
                  появления нового подключения, например `wireguard` или `openvpn`...
vpn net         - команда выводит, список гостевых сетей и их статус.
vpn net add     - подключаем клиентов выбранной гостевой сети так, чтобы клиенты могли
                  ходить на сайты находящиеся в списочном файле. Так, например, мы
                  сможем обеспечить доступ к интернету для гостевой `wifi` или vpn сети.
vpn net del     - команда удаляет из списка подключенных сетей выбранную гостевую сеть.
```

### Внимание!
#### Касается команд "vpn net add/del"
> Прежде чем добавлять сеть необходимо ее сначала подключить в интерфейсе роутера, чтобы она получила свой IP, в противном случае, сеть в списке будет не видна! <br>
> Только затем можно запустить команду на добавление сети.<br>

## Управление shadowsocks соедиением
| Команда        |    Аргументы    |
|----------------|:---------------:|
| kvas ssr       |        -        |
| kvas ssr new   |        -        |
| kvas ssr reset |        -        |
| kvas ssr port  | [порт] / ничего |

```
ssr          - отображаем текущий тип VPN соединения и его состояние (тоже что и ключ 'vpn').

ssr new      - меняет настройки учетной записи shadowsocks сервера на другие настройки, 
               в случае смены сервера или иных данных учетной записи. 

ssr port     - отображаем текущий локальный порт Shadowsocks соединения.
ssr port <N> - меняем текущий локальный порт Shadowsocks соединения на <N>.
ssr reset    - обновляем таблицу правил iptables для Shadowsocks соединения: чистим ее и затем заполняем.
```

### Внимание!
> Начиная с версии пакета **1.1.8-r1**, для команды `kvas ssr new`, появилась возможность вводить данные при помощи, полученной от провайдера, кодированной ссылки в виде **ss://...**, при этом, все что будет находится справа от знака **#** в самой ссылке будет отсечено автоматически. Формат записи должен быть следующим: "**ss://метод_шифрования:пароль@IP_или_домен:порт/**" 

### Доступные методы шифрования 
> Их можно просмотреть по команде `ss-redir --help | grep -A9 '<encrypt_method>'`<br><br>
> На текущий момент, для **shadowsocks-libev 3.3.5**, они следующие:<br>
**rc4-md5, aes-128-gcm, aes-192-gcm, aes-256-gcm, aes-128-cfb, aes-192-cfb, aes-256-cfb, aes-128-ctr, aes-192-ctr, aes-256-ctr, camellia-128-cfb, camellia-192-cfb, camellia-256-cfb, bf-cfb, chacha20-ietf-poly1305, xchacha20-ietf-poly1305, salsa20, chacha20 and chacha20-ietf**.<br><br>
> Метод шифрования по умолчанию: **chacha20-ietf-poly1305**.

### Внимание!
> Основная проблема при подключении по **SSR** это наличие спец. символов в пароле.<br>
> Потому в новых версиях, начиная с **1.1.7-realese-2** введена проверка на ввод пароля - он должен состоять только и исключительно из букв и цифр. 
<br>

> В случае, если у Вас есть только ссылка вида **ss://<PASSWORD_BASE64>@<SERVER_IP>:<PORT>**, то при запросе данных, при создании нового **Shadowsocks** соединения, вставляете **SERVER_IP** и **PORT** из ссылки, в неизменном виде, а вот пароль надо расшифровать.<br>
> С этой целью в поисковике вводим фразу **base64 online decoder**, и, перейдя по [найденой ссылке](https://www.base64decode.org), вставляем туда строку **PASSWORD_BASE64** из ссылки выше (после **ss://** и до "собачки"), и получаете раскодированный пароль, который и необходимо ввести при запросе в **Квасе**.<br><br>

## Управление dnsmasq
| Команда           |    Аргументы    |
|-------------------|:---------------:|
| kvas dnsmasq      |        -        |
| kvas dnsmasq port | [порт] / ничего |
| kvas dnsmasq ip   |  [ip] / ничего  |

```
dnsmasq          - отображаем текущие порт и IP, которые прослушивает служба dnsmasq.
dnsmasq port     - отображаем текущий порт, который прослушивает служба dnsmasq.
dnsmasq port <N> - меняем текущий порт, который прослушивает служба dnsmasq на <N>.
dnsmasq ip       - отображаем текущий IP, который прослушивает служба dnsmasq.
dnsmasq ip <N>   - меняем текущий IP, который прослушивает служба dnsmasq на <N>.
```

## Отладка
| Команда      | Аргументы |
|--------------|:---------:|
| kvas test    |     -     |
| kvas debug   |     -     |
| kvas debug ipset  |     -     |

```
test        - проверка работы всех служб, задействованных в работе КВАСА.
debug       - вывод отладочной информации в случае сбоев в работе КВАСА.
debug ipset - проверка в цикле всех IP доменных имен на наличие в списке ipset.
```

## Помощь

| Команда                        | Аргументы |
|--------------------------------|:---------:|
| kvas version / kvas ver        |     -     |
| kvas help / kvas -h / kvas --h |     -     |

```
version | ver     - отображаем версию утилиты.
help | -h | --h   - отображается справка.  
```

## НАВИГАЦИЯ
- [**<<-- Установка пакета**](https://github.com/qzeleza/kvas/wiki/Установка-пакета)